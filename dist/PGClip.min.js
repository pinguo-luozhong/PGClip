!function(t){window.PGClip=function(t){return t&&!(!t instanceof Object)&&t.wrap&&t.image&&document.querySelector("#"+t.wrap)&&document.querySelector("#"+t.image)?(this.clipWrap=document.querySelector("#"+t.wrap),this.originImage=document.querySelector("#"+t.image),this.clipWrapTop=0,this.scale=1,this.dragable=!1,this.transform={},this.options=t,void a(this)):void console.warn("参数不合法，请传入{wrap:裁剪框ID, image:裁剪图片ID}")};var a=function(t){t.clipWrap.style.overflow="hidden",t.clipWrap.style.position="absolute",t.originImage.style.position="absolute",t.originImage.style.left=0,t.originImage.style.top=0,r(t)},r=function(t){var a=t.originImage,r=t.clipWrap,n=r.clientHeight/r.clientWidth,o=r.clientHeight,i=r.clientWidth,s=a.width,m=a.height,l=0,c=0;return n>m/s?(t.scale=o/m,a.height=c=o,a.width=parseInt(l=o*s/m)):(t.scale=i/s,a.width=l=i,a.height=parseInt(c=i*m/s)),window.Hammer?(e(t),t.maxImagePosition={maxX:0,minX:0+i-l,maxY:0,minY:o-c},t.transform.translate={x:0,y:0},t.maxImagePosition.minY>0&&(t.dragable=!1),void(t.maxImagePosition.minX>0&&(t.dragable=!1))):void console.warn("缺少Hammer.js")},n=PGClip.prototype;n.getParam=function(){var t={srcX:Math.floor((0-this.transform.translate.x)/this.scale),srcY:Math.floor((this.clipWrapTop-this.transform.translate.y)/this.scale),srcW:Math.floor(this.clipWrap.clientWidth/this.scale),srcH:Math.floor(this.clipWrap.clientHeight/this.scale)};return t},n.stopDrag=function(){this.mc.off("panstart panmove",this.onPan),this.mc.off("rotatestart rotatemove",this.onRotate),this.mc.off("pinchstart pinchmove",this.onPinch)},n.startDrag=function(){this.mc.on("panstart panmove",this.onPan),this.mc.on("rotatestart rotatemove",this.onRotate),this.mc.on("pinchstart pinchmove",this.onPinch)};var e=function(t){function a(){t.transform={translate:{x:l,y:c},scale:1,angle:0,rx:0,ry:0,rz:0},n()}function r(){var a=["scale("+t.transform.scale+", "+t.transform.scale+")","rotate3d("+t.transform.rx+","+t.transform.ry+","+t.transform.rz+","+t.transform.angle+"deg)","translate3d("+t.transform.translate.x+"px, "+t.transform.translate.y+"px, 0)"];a=a.join(" "),m.style.webkitTransform=a,m.style.mozTransform=a,m.style.transform=a,p=!1}function n(){p||(s(r),p=!0)}function e(a){if(0!=t.dragable){"panstart"==a.type&&t.transform.translate&&(l=t.transform.translate.x,c=t.transform.translate.y);var r=l+a.deltaX,e=c+a.deltaY;t.transform.translate={x:r,y:e},n()}}function o(a){"pinchstart"==a.type&&(f=t.transform.scale||1),m.className="",t.transform.scale=f*a.scale,n()}function i(a){"rotatestart"==a.type&&(d=t.transform.angle||0),m.className="",t.transform.rz=1,t.transform.angle=d+a.rotation,n()}t.dragable=!0,t.transform={};var s=function(){return window[Hammer.prefixed(window,"requestAnimationFrame")]||function(t){window.setTimeout(t,1e3/60)}}(),m=t.originImage,l=0,c=0,p=!1,h=new Hammer.Manager(t.clipWrap);t.mc=h,h.add(new Hammer.Pan({threshold:0,pointers:0})),h.add(new Hammer.Swipe).recognizeWith(h.get("pan")),h.add(new Hammer.Rotate({threshold:0})).recognizeWith(h.get("pan")),h.add(new Hammer.Pinch({threshold:0})).recognizeWith([h.get("pan"),h.get("rotate")]),h.add(new Hammer.Tap({event:"doubletap",taps:2})),h.add(new Hammer.Tap),h.on("panstart panmove",e),h.on("rotatestart rotatemove",i),h.on("pinchstart pinchmove",o),h.on("hammer.input",function(a){a.isFinal&&t.options.callback&&t.options.callback(t.transform)}),t.onPan=e;var f=1;t.onPinch=o;var d=0;t.onRotate=i,a()};module&&module.exports?module.exports=PGClip:t.PGClip=PGClip}(window);